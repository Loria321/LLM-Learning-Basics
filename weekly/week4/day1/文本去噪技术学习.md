### 1. éœ€æ±‚ç¡®è®¤
ä½ éœ€è¦ç³»ç»Ÿå­¦ä¹ æ–‡æœ¬å»å™ªçš„æ ¸å¿ƒæŠ€æœ¯â€”â€”æ­£åˆ™è¡¨è¾¾å¼ï¼ˆreï¼‰ï¼Œé‡ç‚¹æŒæ¡**å»é™¤HTMLæ ‡ç­¾ã€ç‰¹æ®Šç¬¦å·ã€å¤šä½™ç©ºæ ¼**ï¼Œå¹¶å®æ“æ¸…æ´—IMDBç”µå½±è¯„è®ºä¸­çš„`<br>`æ ‡ç­¾å’Œè¡¨æƒ…ç¬¦å·ï¼Œæœ€ç»ˆç¼–å†™é€šç”¨å»å™ªå‡½æ•°é›†æˆåˆ°ä¹‹å‰çš„æ¸…æ´—è„šæœ¬ä¸­ã€‚æˆ‘ä¼šä»â€œæ­£åˆ™åŸºç¡€â†’åˆ†æ­¥å®æ“â†’å‡½æ•°å°è£…â†’è„šæœ¬é›†æˆâ€å®Œæ•´è®²è§£ï¼Œç¡®ä¿ä½ æ—¢èƒ½ç†è§£åŸç†ï¼Œåˆèƒ½è½åœ°åº”ç”¨ã€‚

### 2. æ­£åˆ™è¡¨è¾¾å¼æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼ˆé’ˆå¯¹æ–‡æœ¬å»å™ªï¼‰
å…ˆæŒæ¡æ–‡æœ¬å»å™ªå¸¸ç”¨çš„æ­£åˆ™è¯­æ³•ï¼Œæ— éœ€æ­»è®°æ‰€æœ‰è§„åˆ™ï¼Œèšç„¦ä»¥ä¸‹æ ¸å¿ƒï¼š

| æ­£åˆ™è¯­æ³• | å«ä¹‰ | å»å™ªåœºæ™¯åº”ç”¨ |
|----------|------|--------------|
| `<.*?>` | éè´ªå©ªåŒ¹é…HTMLæ ‡ç­¾ï¼ˆ`<`å¼€å¤´ï¼Œ`>`ç»“å°¾ï¼Œä¸­é—´ä»»æ„å­—ç¬¦ï¼‰ | å»é™¤`<br>`ã€`<p>`ã€`<div>`ç­‰æ‰€æœ‰HTMLæ ‡ç­¾ |
| `\s+` | åŒ¹é…1ä¸ªåŠä»¥ä¸Šç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œï¼‰ | åˆå¹¶å¤šä½™ç©ºæ ¼ä¸º1ä¸ª |
| `[^\w\s.,!?]` | åŒ¹é…éå­—æ¯/æ•°å­—/ç©ºæ ¼/å¸¸ç”¨æ ‡ç‚¹çš„ç‰¹æ®Šç¬¦å· | å»é™¤ä¹±ç ã€ç‰¹æ®Šç¬¦å·ï¼ˆä¿ç•™åŸºç¡€æ ‡ç‚¹ä¿è¯è¯­ä¹‰ï¼‰ |
| `[\U00010000-\U0010ffff]` | åŒ¹é…Unicodeè¡¨æƒ…ç¬¦å·ï¼ˆemojiï¼‰ | å»é™¤è¯„è®ºä¸­çš„ğŸ˜€ã€ğŸ˜‚ç­‰è¡¨æƒ…ç¬¦å· |
| `br|BR` | ç²¾å‡†åŒ¹é…`<br>`çš„å˜ä½“ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ | å•ç‹¬å¤„ç†`<br>`/`<BR>`/`<br/>`ç­‰æ ‡ç­¾ |

> å…³é”®æ¦‚å¿µï¼š**éè´ªå©ªåŒ¹é…ï¼ˆ`.*?`ï¼‰** vs è´ªå©ªåŒ¹é…ï¼ˆ`.*`ï¼‰ï¼š  
> è´ªå©ªåŒ¹é…ä¼šåŒ¹é…å°½å¯èƒ½å¤šçš„å†…å®¹ï¼ˆæ¯”å¦‚`<a>xx</a><b>yy</b>`ä¼šè¢«æ•´ä½“åŒ¹é…ï¼‰ï¼Œéè´ªå©ªåŒ¹é…åªåŒ¹é…åˆ°æœ€è¿‘çš„`>`ï¼ˆç²¾å‡†åŒ¹é…å•ä¸ªæ ‡ç­¾ï¼‰ï¼Œæ˜¯å¤„ç†HTMLæ ‡ç­¾çš„æ ¸å¿ƒã€‚

### 3. åˆ†æ­¥å®æ“ï¼šç”¨æ­£åˆ™æ¸…æ´—IMDBè¯„è®ºï¼ˆæ ¸å¿ƒå»å™ªé€»è¾‘ï¼‰
æˆ‘ä»¬é’ˆå¯¹IMDBè¯„è®ºçš„å…¸å‹å™ªå£°ï¼ˆ`<br>`æ ‡ç­¾ã€è¡¨æƒ…ç¬¦å·ã€å¤šä½™ç©ºæ ¼ã€ç‰¹æ®Šç¬¦å·ï¼‰ï¼Œåˆ†æ­¥ç¼–å†™æ­£åˆ™å¹¶éªŒè¯æ•ˆæœï¼š

#### æ­¥éª¤1ï¼šæµ‹è¯•æ•°æ®å‡†å¤‡ï¼ˆæ¨¡æ‹Ÿå¸¦å™ªå£°çš„è¯„è®ºï¼‰
```python
import re

# æ¨¡æ‹ŸIMDBå¸¦å™ªå£°çš„è¯„è®º
dirty_text = """
This movie is awesome!<br/> ğŸ˜‚ The acting was top-notch!!!   \t\n
I loved every minute of it!!! ğŸ¬ <p>Highly recommend!!!</p>
"""
print("åŸå§‹å¸¦å™ªå£°æ–‡æœ¬ï¼š")
print(dirty_text)
```

#### æ­¥éª¤2ï¼šé€ç±»å»é™¤å™ªå£°ï¼ˆæ‹†è§£æ¯ä¸€æ­¥ï¼‰
```python
# 1. å»é™¤HTMLæ ‡ç­¾ï¼ˆé‡ç‚¹å¤„ç†<br>ï¼ŒåŒæ—¶å…¼å®¹å…¶ä»–æ ‡ç­¾ï¼‰
# æ­£åˆ™ï¼š<.*?> åŒ¹é…æ‰€æœ‰HTMLæ ‡ç­¾ï¼Œæ›¿æ¢ä¸ºç©ºå­—ç¬¦ä¸²
text = re.sub(r'<.*?>', '', dirty_text)
print("\n1. å»é™¤HTMLæ ‡ç­¾åï¼š")
print(text)

# 2. å»é™¤è¡¨æƒ…ç¬¦å·ï¼ˆåŒ¹é…Unicode emojièŒƒå›´ï¼‰
# æ­£åˆ™ï¼š[\U00010000-\U0010ffff] è¦†ç›–æ‰€æœ‰emojiçš„Unicodeç¼–ç 
text = re.sub(r'[\U00010000-\U0010ffff]', '', text)
print("\n2. å»é™¤è¡¨æƒ…ç¬¦å·åï¼š")
print(text)

# 3. å»é™¤ç‰¹æ®Šç¬¦å·ï¼ˆä¿ç•™å­—æ¯ã€æ•°å­—ã€ç©ºæ ¼ã€å¸¸ç”¨æ ‡ç‚¹ï¼‰
# æ­£åˆ™ï¼š[^\w\s.,!?] åŒ¹é…éå­—æ¯/æ•°å­—/ç©ºæ ¼/.,!?çš„å­—ç¬¦ï¼Œæ›¿æ¢ä¸ºç©º
text = re.sub(r'[^\w\s.,!?]', '', text)
print("\n3. å»é™¤ç‰¹æ®Šç¬¦å·åï¼š")
print(text)

# 4. åˆå¹¶å¤šä½™ç©ºæ ¼ï¼ˆæ¢è¡Œ/åˆ¶è¡¨ç¬¦/å¤šç©ºæ ¼â†’å•ä¸ªç©ºæ ¼ï¼‰
# æ­£åˆ™ï¼š\s+ åŒ¹é…æ‰€æœ‰ç©ºç™½å­—ç¬¦ï¼Œæ›¿æ¢ä¸ºå•ä¸ªç©ºæ ¼ï¼›strip()å»é™¤é¦–å°¾ç©ºæ ¼
text = re.sub(r'\s+', ' ', text).strip()
print("\n4. åˆå¹¶å¤šä½™ç©ºæ ¼åï¼ˆæœ€ç»ˆå»å™ªç»“æœï¼‰ï¼š")
print(text)
```

#### æ­¥éª¤3ï¼šè¿è¡Œç»“æœï¼ˆéªŒè¯å»å™ªæ•ˆæœï¼‰
```
åŸå§‹å¸¦å™ªå£°æ–‡æœ¬ï¼š

This movie is awesome!<br/> ğŸ˜‚ The acting was top-notch!!!   	
I loved every minute of it!!! ğŸ¬ <p>Highly recommend!!!</p>

1. å»é™¤HTMLæ ‡ç­¾åï¼š

This movie is awesome! ğŸ˜‚ The acting was top-notch!!!   	
I loved every minute of it!!! ğŸ¬ Highly recommend!!!

2. å»é™¤è¡¨æƒ…ç¬¦å·åï¼š

This movie is awesome!  The acting was top-notch!!!   	
I loved every minute of it!!!  Highly recommend!!!

3. å»é™¤ç‰¹æ®Šç¬¦å·åï¼š

This movie is awesome!  The acting was top notch!!!   	
I loved every minute of it!!!  Highly recommend!!!

4. åˆå¹¶å¤šä½™ç©ºæ ¼åï¼ˆæœ€ç»ˆå»å™ªç»“æœï¼‰ï¼š
This movie is awesome! The acting was top notch!!! I loved every minute of it!!! Highly recommend!!!
```

### 4. å°è£…é€šç”¨æ–‡æœ¬å»å™ªå‡½æ•°
å°†ä¸Šè¿°åˆ†æ­¥é€»è¾‘å°è£…ä¸ºå¯å¤ç”¨çš„å‡½æ•°ï¼Œé€‚é…IMDBè¯„è®ºåœºæ™¯ï¼Œå¢åŠ **ç¼–ç ç»Ÿä¸€ã€å¤§å°å†™å¯é€‰**ç­‰å¢å¼ºåŠŸèƒ½ï¼š
```python
import re
import unicodedata

def clean_text_noise(text, lower_case=False):
    """
    é€šç”¨æ–‡æœ¬å»å™ªå‡½æ•°ï¼ˆé€‚é…IMDBç”µå½±è¯„è®ºï¼‰
    :param text: åŸå§‹æ–‡æœ¬å­—ç¬¦ä¸²
    :param lower_case: æ˜¯å¦è½¬ä¸ºå°å†™ï¼ˆå¯é€‰ï¼Œæ–‡æœ¬åˆ†æå¸¸ç”¨ï¼‰
    :return: å»å™ªåçš„å¹²å‡€æ–‡æœ¬
    """
    # ç©ºå€¼å¤„ç†ï¼šé¿å…ä¼ å…¥None/NaNå¯¼è‡´æŠ¥é”™
    if pd.isna(text) or text is None:
        return ""
    
    # æ­¥éª¤1ï¼šç»Ÿä¸€ç¼–ç ï¼ˆå¤„ç†ä¹±ç ã€éUTF-8å­—ç¬¦ï¼‰
    text = unicodedata.normalize('NFKD', text).encode('utf-8', 'ignore').decode('utf-8')
    
    # æ­¥éª¤2ï¼šå»é™¤HTMLæ ‡ç­¾ï¼ˆé‡ç‚¹<br>ã€<p>ç­‰ï¼‰
    text = re.sub(r'<.*?>', '', text)
    
    # æ­¥éª¤3ï¼šå»é™¤è¡¨æƒ…ç¬¦å·ï¼ˆUnicode emojiï¼‰
    emoji_pattern = re.compile("["
                               u"\U0001F600-\U0001F64F"  # è¡¨æƒ…ç¬¦å·
                               u"\U0001F300-\U0001F5FF"  # ç¬¦å·/å›¾æ ‡
                               u"\U0001F680-\U0001F6FF"  # äº¤é€š/åœ°å›¾ç¬¦å·
                               u"\U0001F1E0-\U0001F1FF"  # å›½æ——
                               u"\U00002500-\U00002BEF"  # æ‚é¡¹ç¬¦å·
                               u"\U00002702-\U000027B0"
                               u"\U000024C2-\U0001F251"
                               u"\U0001f926-\U0001f937"
                               u"\U00010000-\U0010ffff"
                               u"\u2640-\u2642"
                               u"\u2600-\u2B55"
                               u"\u200d"
                               u"\u23cf"
                               u"\u23e9"
                               u"\u231a"
                               u"\ufe0f"  # å˜ä½“é€‰æ‹©ç¬¦
                               u"\u3030"
                               "]+", flags=re.UNICODE)
    text = emoji_pattern.sub(r'', text)
    
    # æ­¥éª¤4ï¼šå»é™¤ç‰¹æ®Šç¬¦å·ï¼ˆä¿ç•™å­—æ¯ã€æ•°å­—ã€ç©ºæ ¼ã€å¸¸ç”¨æ ‡ç‚¹ï¼‰
    text = re.sub(r'[^\w\s.,!?\']', ' ', text)  # ä¿ç•™å•å¼•å·ï¼ˆæ¯”å¦‚don'tï¼‰
    
    # æ­¥éª¤5ï¼šåˆå¹¶å¤šä½™ç©ºæ ¼ï¼ˆæ¢è¡Œ/åˆ¶è¡¨ç¬¦â†’å•ä¸ªç©ºæ ¼ï¼‰
    text = re.sub(r'\s+', ' ', text).strip()
    
    # æ­¥éª¤6ï¼šå¯é€‰è½¬ä¸ºå°å†™ï¼ˆæ–‡æœ¬åˆ†æå¸¸ç”¨ï¼‰
    if lower_case:
        text = text.lower()
    
    return text
```

### 5. é›†æˆåˆ°IMDBæ¸…æ´—è„šæœ¬ï¼ˆå®Œæ•´æœ€ç»ˆç‰ˆï¼‰
å°†å»å™ªå‡½æ•°é›†æˆåˆ°ä¹‹å‰çš„æ¸…æ´—è„šæœ¬ä¸­ï¼Œæ›¿æ¢åŸæœ‰çš„ç®€å•æ–‡æœ¬æ¸…ç†é€»è¾‘ï¼Œå®Œæ•´è„šæœ¬å¦‚ä¸‹ï¼š
```python
import pandas as pd
import numpy as np
import logging
from datetime import datetime
import os
import argparse
import traceback
import re
import unicodedata

# ===================== 1. æ—¥å¿—é…ç½® =====================
def setup_logger(log_path):
    log_file = f"{log_path}_IMDBæ¸…æ´—æ—¥å¿—_{datetime.now().strftime('%Y%m%d_%H%M%S')}.log"
    logger = logging.getLogger("data_cleaner")
    logger.setLevel(logging.INFO)
    logger.handlers.clear()
    formatter = logging.Formatter('%(asctime)s - %(levelname)s - %(message)s', datefmt='%Y-%m-%d %H:%M:%S')
    console_handler = logging.StreamHandler()
    console_handler.setFormatter(formatter)
    file_handler = logging.FileHandler(log_file, encoding='utf-8')
    file_handler.setFormatter(formatter)
    logger.addHandler(console_handler)
    logger.addHandler(file_handler)
    return logger, log_file

# ===================== 2. æ ¸å¿ƒæ–‡æœ¬å»å™ªå‡½æ•° =====================
def clean_text_noise(text, lower_case=False):
    """é€šç”¨æ–‡æœ¬å»å™ªå‡½æ•°ï¼šå»é™¤HTMLæ ‡ç­¾ã€emojiã€ç‰¹æ®Šç¬¦å·ã€å¤šä½™ç©ºæ ¼"""
    if pd.isna(text) or text is None:
        return ""
    # ç»Ÿä¸€ç¼–ç 
    text = unicodedata.normalize('NFKD', text).encode('utf-8', 'ignore').decode('utf-8')
    # å»é™¤HTMLæ ‡ç­¾
    text = re.sub(r'<.*?>', '', text)
    # å»é™¤emoji
    emoji_pattern = re.compile("["
                               u"\U0001F600-\U0001F64F"
                               u"\U0001F300-\U0001F5FF"
                               u"\U0001F680-\U0001F6FF"
                               u"\U0001F1E0-\U0001F1FF"
                               u"\U00002500-\U00002BEF"
                               u"\U00002702-\U000027B0"
                               u"\U000024C2-\U0001F251"
                               u"\U0001f926-\U0001f937"
                               u"\U00010000-\U0010ffff"
                               u"\u2640-\u2642"
                               u"\u2600-\u2B55"
                               u"\u200d"
                               u"\u23cf"
                               u"\u23e9"
                               u"\u231a"
                               u"\ufe0f"
                               u"\u3030"
                               "]+", flags=re.UNICODE)
    text = emoji_pattern.sub(r'', text)
    # å»é™¤ç‰¹æ®Šç¬¦å·ï¼ˆä¿ç•™åŸºç¡€æ ‡ç‚¹ï¼‰
    text = re.sub(r'[^\w\s.,!?\']', ' ', text)
    # åˆå¹¶å¤šä½™ç©ºæ ¼
    text = re.sub(r'\s+', ' ', text).strip()
    # å¯é€‰å°å†™
    if lower_case:
        text = text.lower()
    return text

# ===================== 3. æ ¸å¿ƒæ¸…æ´—å‡½æ•°ï¼ˆé›†æˆå»å™ªï¼‰ =====================
def clean_imdb_data(
    input_path,          
    output_path,         
    log_path="IMDBæ¸…æ´—æ—¥å¿—",  
    duplicate_threshold=100.0,
    missing_fill_strategy="drop",
    missing_col_threshold=30.0,    
    outlier_method="IQR",          
    outlier_threshold=5.0          
):
    logger, log_file = setup_logger(log_path)
    logger.info("="*60)
    logger.info("å¼€å§‹æ‰§è¡ŒIMDBç”µå½±è¯„è®ºæ•°æ®æ¸…æ´—æµç¨‹ï¼ˆå«æ–‡æœ¬å»å™ªï¼‰")
    logger.info(f"è¾“å…¥æ–‡ä»¶ï¼š{input_path} | æ ¸å¿ƒï¼šå»é‡+åˆ ç©º+æ–‡æœ¬å»å™ª+ç¼–ç ç»Ÿä¸€")
    logger.info("="*60)

    try:
        # å‰ç½®æ ¡éªŒ
        logger.info("ã€å‰ç½®æ ¡éªŒã€‘æ£€æŸ¥æ–‡ä»¶æ ¼å¼å’Œå­˜åœ¨æ€§")
        if not os.path.exists(input_path):
            raise FileNotFoundError(f"è¾“å…¥æ–‡ä»¶ä¸å­˜åœ¨ï¼š{input_path}")
        if not input_path.lower().endswith('.csv'):
            raise ValueError(f"è¾“å…¥æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼ä»…æ”¯æŒCSVæ–‡ä»¶")

        # æ•°æ®åŠ è½½
        logger.info("ã€æ­¥éª¤1ï¼šæ•°æ®åŠ è½½ã€‘")
        df = pd.read_csv(input_path, encoding='utf-8', on_bad_lines='skip')
        original_shape = df.shape
        logger.info(f"åŸå§‹æ•°æ®ç»´åº¦ï¼š{original_shape[0]}è¡Œ Ã— {original_shape[1]}åˆ—")
        if df.empty:
            raise ValueError("åŠ è½½çš„CSVæ–‡ä»¶ä¸ºç©ºï¼Œæ— æ•°æ®å¯æ¸…æ´—")
        if 'text' not in df.columns or 'sentiment' not in df.columns:
            raise ValueError("IMDBæ•°æ®ç¼ºå°‘å¿…è¦åˆ—ï¼štextï¼ˆè¯„è®ºï¼‰æˆ–sentimentï¼ˆæƒ…æ„Ÿæ ‡ç­¾ï¼‰")
        
        # æ¢ç´¢æ€§åˆ†æ
        logger.info("\nã€æ­¥éª¤2ï¼šè¯„è®ºæ•°æ®æ¢ç´¢ã€‘")
        empty_comment = df['text'].isna().sum() + (df['text'].str.strip() == '').sum()
        empty_rate = round((empty_comment / len(df) * 100), 2)
        duplicate_comment = df['text'].duplicated().sum()
        duplicate_rate = round((duplicate_comment / len(df) * 100), 2)
        logger.info(f"ç©ºè¯„è®ºæ•°é‡ï¼š{empty_comment} | å æ¯”ï¼š{empty_rate}%")
        logger.info(f"é‡å¤è¯„è®ºæ•°é‡ï¼š{duplicate_comment} | å æ¯”ï¼š{duplicate_rate}%")

        # æ ¸å¿ƒæ¸…æ´—
        logger.info("\nã€æ­¥éª¤3ï¼šæ ¸å¿ƒæ¸…æ´—ã€‘")
        # 3.1 å»é‡ï¼ˆåŸºäºè¯„è®ºæ–‡æœ¬ï¼‰
        df = df.drop_duplicates(subset=['text'], keep='first')
        logger.info(f"å»é‡åæ•°æ®é‡ï¼š{len(df)}æ¡ï¼ˆåˆ é™¤é‡å¤è¯„è®º{original_shape[0]-len(df)}æ¡ï¼‰")
        after_dup_shape = len(df)

        # 3.2 åˆ é™¤ç©ºè¯„è®º
        df = df[df['text'].notna()]
        df = df[df['text'].str.strip() != '']
        after_empty_shape = len(df)
        logger.info(f"åˆ é™¤ç©ºè¯„è®ºåæ•°æ®é‡ï¼š{after_empty_shape}æ¡ï¼ˆåˆ é™¤ç©ºè¯„è®º{after_dup_shape - after_empty_shape}æ¡ï¼‰")

        # 3.3 æ–‡æœ¬å»å™ªï¼ˆæ ¸å¿ƒæ–°å¢ï¼‰
        logger.info("å¼€å§‹æ–‡æœ¬å»å™ªï¼šå»é™¤HTMLæ ‡ç­¾ã€emojiã€ç‰¹æ®Šç¬¦å·ã€å¤šä½™ç©ºæ ¼")
        # å¯¹textåˆ—åº”ç”¨å»å™ªå‡½æ•°ï¼Œå¯é€‰è½¬ä¸ºå°å†™ï¼ˆlower_case=Trueï¼‰
        df['text'] = df['text'].apply(lambda x: clean_text_noise(x, lower_case=True))
        # å»å™ªåå¯èƒ½äº§ç”Ÿæ–°çš„ç©ºå­—ç¬¦ä¸²ï¼Œå†æ¬¡è¿‡æ»¤
        df = df[df['text'].str.strip() != '']
        after_noise_shape = len(df)
        logger.info(f"æ–‡æœ¬å»å™ªåæ•°æ®é‡ï¼š{after_noise_shape}æ¡ï¼ˆå»å™ªååˆ é™¤ç©ºè¯„è®º{after_empty_shape - after_noise_shape}æ¡ï¼‰")

        # æ•°æ®ä¿å­˜
        logger.info("\nã€æ­¥éª¤4ï¼šæ•°æ®ä¿å­˜ã€‘")
        output_dir = os.path.dirname(output_path)
        if output_dir and not os.path.exists(output_dir):
            os.makedirs(output_dir)
        df.to_csv(output_path, index=False, encoding='utf-8')
        final_shape = len(df)
        
        # æ¸…æ´—ç‡è®¡ç®—
        clean_rate = round(((original_shape[0] - final_shape) / original_shape[0]) * 100, 2)
        logger.info("="*60)
        logger.info("âœ… IMDBè¯„è®ºæ¸…æ´—+å»å™ªå®Œæˆï¼")
        logger.info(f"åŸå§‹æ•°æ®é‡ï¼š{original_shape[0]}æ¡")
        logger.info(f"æ¸…æ´—åæ•°æ®é‡ï¼š{final_shape}æ¡")
        logger.info(f"åˆ é™¤æ•°æ®é‡ï¼š{original_shape[0] - final_shape}æ¡")
        logger.info(f"æ¸…æ´—ç‡ï¼š{clean_rate}%")
        logger.info(f"è¾“å‡ºæ–‡ä»¶ï¼š{output_path}")
        logger.info("="*60)

        return df, log_file, clean_rate

    except Exception as e:
        logger.error(f"æ¸…æ´—è¿‡ç¨‹å‡ºé”™ï¼š{str(e)}", exc_info=True)
        logger.error(f"å¼‚å¸¸è¯¦ç»†æ ˆä¿¡æ¯ï¼š\n{traceback.format_exc()}")
        return None, log_file, 0.0

# ===================== 4. å‘½ä»¤è¡Œå‚æ•°é…ç½® =====================
def parse_args():
    parser = argparse.ArgumentParser(description="IMDBç”µå½±è¯„è®ºæ¸…æ´—è„šæœ¬ï¼ˆå«æ–‡æœ¬å»å™ªï¼‰")
    parser.add_argument('-i', '--input', required=True, help="è¾“å…¥IMDB CSVæ–‡ä»¶è·¯å¾„")
    parser.add_argument('-o', '--output', required=True, help="è¾“å‡ºæ¸…æ´—åCSVæ–‡ä»¶è·¯å¾„")
    parser.add_argument('-l', '--log', default="IMDBæ¸…æ´—æ—¥å¿—", help="æ—¥å¿—æ–‡ä»¶åŸºç¡€è·¯å¾„")
    return parser.parse_args()

# ===================== 5. ä¸»å‡½æ•° =====================
def main():
    args = parse_args()
    print("="*60)
    print("IMDBç”µå½±è¯„è®ºæ¸…æ´—è„šæœ¬ï¼ˆå«æ–‡æœ¬å»å™ªï¼‰")
    print(f"è¾“å…¥æ–‡ä»¶ï¼š{args.input}")
    print(f"è¾“å‡ºæ–‡ä»¶ï¼š{args.output}")
    print("="*60)
    
    cleaned_df, log_file, clean_rate = clean_imdb_data(
        input_path=args.input,
        output_path=args.output,
        log_path=args.log
    )
    
    if cleaned_df is not None:
        print(f"\nâœ… æ¸…æ´—æˆåŠŸï¼")
        print(f"ğŸ“Š æ¸…æ´—ç»Ÿè®¡ï¼š")
        print(f"   - åŸå§‹æ•°æ®é‡ï¼š{pd.read_csv(args.input).shape[0]}æ¡")
        print(f"   - æ¸…æ´—åæ•°æ®é‡ï¼š{len(cleaned_df)}æ¡")
        print(f"   - æ¸…æ´—ç‡ï¼š{clean_rate}%")
        # é¢„è§ˆå»å™ªæ•ˆæœ
        print(f"\nğŸ“ å»å™ªæ•ˆæœé¢„è§ˆï¼ˆå‰2æ¡è¯„è®ºï¼‰ï¼š")
        original_df = pd.read_csv(args.input).head(2)['text']
        cleaned_text = cleaned_df.head(2)['text']
        for i in range(2):
            print(f"\nåŸå§‹è¯„è®º{i+1}ï¼š\n{original_df.iloc[i][:100]}...")
            print(f"å»å™ªåè¯„è®º{i+1}ï¼š\n{cleaned_text.iloc[i][:100]}...")
        print(f"\nğŸ“ æ—¥å¿—æ–‡ä»¶ï¼š{log_file}")
    else:
        print(f"\nâŒ æ¸…æ´—å¤±è´¥ï¼")
        print(f"ğŸ“ é”™è¯¯æ—¥å¿—ï¼š{log_file}")

# ===================== å…¥å£å‡½æ•° =====================
if __name__ == "__main__":
    try:
        main()
    except SystemExit:
        # æµ‹è¯•æ¨¡å¼
        print("\nâš ï¸  æœªä¼ å…¥å‘½ä»¤è¡Œå‚æ•°ï¼Œæ‰§è¡Œæµ‹è¯•æ¨¡å¼...")
        try:
            df = pd.read_csv("https://raw.githubusercontent.com/laxmimerit/IMDB-Movie-Reviews-Dataset/master/IMDB%20Dataset.csv")
            df = df.head(5000)
            df.to_csv("imdb_5000.csv", index=False, encoding='utf-8')
            print(f"âœ… è‡ªåŠ¨ä¸‹è½½IMDBæ•°æ®ï¼šimdb_5000.csvï¼ˆ{len(df)}æ¡ï¼‰")
        except Exception as e:
            print(f"âŒ è‡ªåŠ¨ä¸‹è½½å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨ä¸‹è½½æ•°æ®é›†ï¼é”™è¯¯ï¼š{e}")
            exit(1)
        # æ‰§è¡Œæ¸…æ´—
        cleaned_df, log_file, clean_rate = clean_imdb_data(
            input_path="imdb_5000.csv",
            output_path="imdb_5000_cleaned.csv",
            log_path="IMDBæ¸…æ´—æ—¥å¿—"
        )
        # è¾“å‡ºç»“æœ
        if cleaned_df is not None:
            print(f"\nâœ… æµ‹è¯•æ¨¡å¼ - æ¸…æ´—æˆåŠŸï¼")
            print(f"ğŸ“Š æ¸…æ´—ç»Ÿè®¡ï¼š")
            print(f"   - åŸå§‹æ•°æ®é‡ï¼š5000æ¡")
            print(f"   - æ¸…æ´—åæ•°æ®é‡ï¼š{len(cleaned_df)}æ¡")
            print(f"   - æ¸…æ´—ç‡ï¼š{clean_rate}%")
            print(f"\nğŸ“ å»å™ªæ•ˆæœé¢„è§ˆï¼ˆç¬¬1æ¡è¯„è®ºï¼‰ï¼š")
            print(f"åŸå§‹ï¼š{pd.read_csv('imdb_5000.csv').head(1)['text'].iloc[0][:100]}...")
            print(f"å»å™ªåï¼š{cleaned_df.head(1)['text'].iloc[0][:100]}...")
        else:
            print(f"\nâŒ æµ‹è¯•æ¨¡å¼ - æ¸…æ´—å¤±è´¥ï¼")
```

### 6. è¿è¡Œä¸éªŒè¯
#### æ–¹å¼1ï¼šå‘½ä»¤è¡Œè¿è¡Œ
```bash
python imdb_cleaner_v3.py -i imdb_5000.csv -o imdb_5000_cleaned.csv
```

#### æ–¹å¼2ï¼šç›´æ¥è¿è¡Œï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰
è„šæœ¬ä¼šè‡ªåŠ¨ä¸‹è½½5000æ¡IMDBæ•°æ®ï¼Œæ‰§è¡Œæ¸…æ´—å¹¶è¾“å‡º**å»å™ªæ•ˆæœé¢„è§ˆ**ï¼Œä¾‹å¦‚ï¼š
```
ğŸ“ å»å™ªæ•ˆæœé¢„è§ˆï¼ˆç¬¬1æ¡è¯„è®ºï¼‰ï¼š
åŸå§‹ï¼šOne of the other reviewers has mentioned that after watching just 1 Oz episode you'll be hooked. They are right, as this is exactly what happened with me.<br /><br />The first thing that struck me about Oz was its brutality and unflinching...
å»å™ªåï¼š
one of the other reviewers has mentioned that after watching just 1 oz episode you'll be hooked. they are right as this is exactly what happened with me. the first thing that struck me about oz was its brutality and unflinching...
```

### 7. æ€»ç»“
1. **æ­£åˆ™æ ¸å¿ƒ**ï¼šæŒæ¡`<.*?>`ï¼ˆHTMLæ ‡ç­¾ï¼‰ã€emojiæ­£åˆ™ï¼ˆè¡¨æƒ…ç¬¦å·ï¼‰ã€`\s+`ï¼ˆå¤šä½™ç©ºæ ¼ï¼‰æ˜¯æ–‡æœ¬å»å™ªçš„å…³é”®ï¼›
2. **å»å™ªå‡½æ•°**ï¼š`clean_text_noise`å°è£…äº†å®Œæ•´çš„å»å™ªé€»è¾‘ï¼Œå¯å¤ç”¨è‡³ä»»æ„æ–‡æœ¬åœºæ™¯ï¼ˆè¯„è®ºã€æ–°é—»ã€èŠå¤©è®°å½•ï¼‰ï¼›
3. **è„šæœ¬é›†æˆ**ï¼šå°†å»å™ªå‡½æ•°åµŒå…¥åŸæœ‰æ¸…æ´—æµç¨‹ï¼Œæ–°å¢â€œå»å™ªåç©ºè¯„è®ºè¿‡æ»¤â€ï¼Œä¿è¯æ•°æ®è´¨é‡ï¼›
4. **æ•ˆæœéªŒè¯**ï¼šè„šæœ¬è‡ªåŠ¨è¾“å‡ºå»å™ªå‰åçš„é¢„è§ˆï¼Œå¯ç›´è§‚éªŒè¯`<br>`æ ‡ç­¾ã€è¡¨æƒ…ç¬¦å·æ˜¯å¦è¢«æˆåŠŸå»é™¤ã€‚

**å…³é”®è®°å¿†ç‚¹**ï¼š
- å»é™¤HTMLæ ‡ç­¾ï¼š`re.sub(r'<.*?>', '', text)`ï¼›
- å»é™¤emojiï¼šä½¿ç”¨è¦†ç›–å…¨UnicodeèŒƒå›´çš„emojiæ­£åˆ™ï¼›
- åˆå¹¶ç©ºæ ¼ï¼š`re.sub(r'\s+', ' ', text).strip()`ã€‚
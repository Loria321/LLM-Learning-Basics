"""
æ ¡å›­é—®ç­”æ•°æ®æ ¡éªŒå·¥å…·
åŠŸèƒ½ï¼š
1. æ ¡éªŒå­—æ®µç±»å‹ï¼ˆé—®é¢˜/ç­”æ¡ˆå¿…é¡»ä¸ºå­—ç¬¦ä¸²ï¼‰
2. æ ¡éªŒé€»è¾‘ä¸€è‡´æ€§ï¼ˆé—®é¢˜éç©ºã€ç­”æ¡ˆâ‰¥10å­—ï¼‰
3. ç­›é€‰æœ‰æ•ˆæ•°æ®ï¼Œè¾“å‡ºæ— æ•ˆæ•°æ®è¯¦æƒ…
"""

def validate_qa_data(qa_item):
    """
    æ ¡éªŒå•æ¡é—®ç­”æ•°æ®çš„æœ‰æ•ˆæ€§
    :param qa_item: å­—å…¸æ ¼å¼çš„é—®ç­”æ•°æ®ï¼Œéœ€åŒ…å« 'question' å’Œ 'answer' å­—æ®µ
    :return: tuple (is_valid: bool, error_msg: str)
             is_valid: æ•°æ®æ˜¯å¦æœ‰æ•ˆï¼ˆTrue/Falseï¼‰
             error_msg: æ— æ•ˆæ—¶çš„é”™è¯¯ä¿¡æ¯ï¼Œæœ‰æ•ˆæ—¶ä¸ºç©ºå­—ç¬¦ä¸²
    """
    # 1. å­—æ®µç±»å‹æ ¡éªŒï¼šæ£€æŸ¥å¿…è¦å­—æ®µæ˜¯å¦å­˜åœ¨ä¸”ç±»å‹ä¸ºå­—ç¬¦ä¸²
    required_fields = ['question', 'answer']
    for field in required_fields:
        # æ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨
        if field not in qa_item:
            return False, f"ç¼ºå°‘å¿…è¦å­—æ®µï¼š{field}"
        # æ£€æŸ¥å­—æ®µç±»å‹æ˜¯å¦ä¸ºå­—ç¬¦ä¸²
        if not isinstance(qa_item[field], str):
            return False, f"{field}å­—æ®µç±»å‹é”™è¯¯ï¼Œå¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼ˆå½“å‰ç±»å‹ï¼š{type(qa_item[field])}ï¼‰"
    
    # 2. é€»è¾‘ä¸€è‡´æ€§æ ¡éªŒï¼šå¤„ç†ç©ºæ ¼åæ£€æŸ¥æ ¸å¿ƒè§„åˆ™
    question = qa_item['question'].strip()  # å»é™¤é—®é¢˜å‰åç©ºæ ¼
    answer = qa_item['answer'].strip()      # å»é™¤ç­”æ¡ˆå‰åç©ºæ ¼
    
    # æ£€æŸ¥é—®é¢˜æ˜¯å¦ä¸ºç©ºï¼ˆå«çº¯ç©ºæ ¼æƒ…å†µï¼‰
    if not question:
        return False, "é—®é¢˜ä¸ºç©ºï¼ˆåŒ…å«çº¯ç©ºæ ¼çš„æƒ…å†µï¼‰"
    
    # æ£€æŸ¥ç­”æ¡ˆé•¿åº¦æ˜¯å¦â‰¥10å­—
    if len(answer) < 10:
        return False, f"ç­”æ¡ˆè¿‡çŸ­ï¼ˆå½“å‰{len(answer)}å­—ï¼Œè¦æ±‚â‰¥10å­—ï¼‰ï¼š{answer}"
    
    # æ‰€æœ‰æ ¡éªŒè§„åˆ™é€šè¿‡
    return True, ""


# import pandas as pd
# # è¯»å–CSVæ–‡ä»¶
# df = pd.read_csv("ä½ çš„æ ¡å›­é—®ç­”æ•°æ®.csv")
# # è½¬æ¢ä¸ºå­—å…¸åˆ—è¡¨ï¼ˆé€‚é…æ ¡éªŒå‡½æ•°ï¼‰
# campus_qa_dataset = df.to_dict('records')


# ===================== æ ¸å¿ƒæ‰§è¡Œé€»è¾‘ =====================
if __name__ == "__main__":
    # 1. æ¨¡æ‹Ÿæ ¡å›­é—®ç­”æ•°æ®é›†ï¼ˆå¯æ›¿æ¢ä¸ºä½ çš„çœŸå®æ•°æ®é›†ï¼‰
    campus_qa_dataset = [
        {"question": "å›¾ä¹¦é¦†å‡ ç‚¹å…³é—¨ï¼Ÿ", "answer": "å›¾ä¹¦é¦†å‘¨ä¸€åˆ°å‘¨äº”22ç‚¹å…³é—¨ï¼Œå‘¨æœ«21ç‚¹å…³é—¨"},  # æœ‰æ•ˆ
        {"question": "", "answer": "å¼€å­¦æ—¶é—´æ˜¯9æœˆ1æ—¥"},  # é—®é¢˜ä¸ºç©º
        {"question": "é£Ÿå ‚æœ‰æ¸…çœŸçª—å£å—ï¼Ÿ", "answer": "æœ‰"},  # ç­”æ¡ˆè¿‡çŸ­
        {"question": "   ", "answer": "å®¿èˆé™ç”µåŠŸç‡æ˜¯800ç“¦"},  # é—®é¢˜ä¸ºçº¯ç©ºæ ¼
        {"question": "è¡¥è€ƒæ€ä¹ˆç”³è¯·ï¼Ÿ", "answer": "   è¡¥è€ƒéœ€åœ¨æˆç»©å…¬å¸ƒå3å¤©å†…æ‰¾è¾…å¯¼å‘˜æäº¤ç”³è¯·è¡¨æ ¼   "},  # æœ‰æ•ˆ
        {"question": 123, "answer": "å¥–å­¦é‡‘ç”³è¯·æ¡ä»¶çœ‹å­¦ç”Ÿæ‰‹å†Œ"},  # é—®é¢˜ç±»å‹é”™è¯¯
        {"question": "é€‰ä¿®è¯¾æ€ä¹ˆé€‰ï¼Ÿ", "answer": "ç™»å½•æ•™åŠ¡ç³»ç»Ÿï¼Œåœ¨é€‰è¯¾æ¿å—é€‰æ‹©å³å¯"}  # æœ‰æ•ˆ
    ]

    # 2. åˆå§‹åŒ–æœ‰æ•ˆ/æ— æ•ˆæ•°æ®å­˜å‚¨åˆ—è¡¨
    valid_data = []       # å­˜å‚¨æ ¡éªŒé€šè¿‡çš„æœ‰æ•ˆæ•°æ®
    invalid_data = []     # å­˜å‚¨æ ¡éªŒå¤±è´¥çš„æ— æ•ˆæ•°æ®ï¼ˆå«é”™è¯¯ä¿¡æ¯ï¼‰

    # 3. éå†æ•°æ®é›†ï¼Œé€è¡Œæ ¡éªŒ
    for idx, qa_item in enumerate(campus_qa_dataset):
        is_valid, error_msg = validate_qa_data(qa_item)
        if is_valid:
            valid_data.append(qa_item)
        else:
            # è®°å½•æ— æ•ˆæ•°æ®çš„åºå·ã€åŸå§‹æ•°æ®ã€é”™è¯¯åŸå› 
            invalid_data.append({
                "index": idx,
                "original_data": qa_item,
                "error_reason": error_msg
            })

    # 4. è¾“å‡ºæ ¡éªŒç»“æœæ±‡æ€»
    print("="*50)
    print("æ ¡å›­é—®ç­”æ•°æ®æ ¡éªŒç»“æœæ±‡æ€»")
    print("="*50)
    print(f"ğŸ“Š åŸå§‹æ•°æ®æ€»æ•°ï¼š{len(campus_qa_dataset)}")
    print(f"âœ… æœ‰æ•ˆæ•°æ®æ•°é‡ï¼š{len(valid_data)}")
    print(f"âŒ æ— æ•ˆæ•°æ®æ•°é‡ï¼š{len(invalid_data)}")

    # 5. è¾“å‡ºæ— æ•ˆæ•°æ®è¯¦æƒ…ï¼ˆä¾¿äºæ’æŸ¥é—®é¢˜ï¼‰
    if invalid_data:
        print("\n" + "="*50)
        print("æ— æ•ˆæ•°æ®è¯¦æƒ…")
        print("="*50)
        for item in invalid_data:
            print(f"\nåºå·ï¼š{item['index']}")
            print(f"é”™è¯¯åŸå› ï¼š{item['error_reason']}")
            print(f"åŸå§‹æ•°æ®ï¼š{item['original_data']}")

    # 6. è¾“å‡ºç­›é€‰åçš„æœ‰æ•ˆæ•°æ®
    if valid_data:
        print("\n" + "="*50)
        print("ç­›é€‰åçš„æœ‰æ•ˆæ•°æ®")
        print("="*50)
        for i, data in enumerate(valid_data, 1):
            print(f"\n{i}. é—®é¢˜ï¼š{data['question']}")
            print(f"   ç­”æ¡ˆï¼š{data['answer']}")

    # 7. æœ€ç»ˆä¿ç•™çš„æœ‰æ•ˆæ•°æ®é›†ï¼ˆå¯ç›´æ¥ç”¨äºåç»­åˆ†æ/å­˜å‚¨ï¼‰
    final_valid_dataset = valid_data
    print("\n" + "="*50)
    print("âœ… æ•°æ®æ ¡éªŒå®Œæˆï¼Œæœ‰æ•ˆæ•°æ®é›†å·²ä¿å­˜è‡³å˜é‡ final_valid_dataset") 